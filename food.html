<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"> -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />


  <title>{{college.capitalize()}} {{meal_time}} Menu</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/food.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/reactions.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lato" />
</head>

<body>

  <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-primary">
    <div class="container-fluid">
       <a class="navbar-brand fs-4" href="index"><img src="https://i.imgur.com/AufcPrM.png" width="auto" height="50"> TigerTooth</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active fs-6 me-2" aria-current="page" href="/reactions?college={{college}}">View
              {{college.capitalize()}} Reactions</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active fs-6" aria-current="page" href="/history">Your Reviews</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- <nav class="navbar sticky-top navbar-light bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand fs-4" href="index">TigerTooth</a>
      <div class="navbar-nav">
        <a class="nav-link active me-1 fs-6 d-sm-none" aria-current="page" href="/reactions?college={{college}}">View
          {{college.capitalize()}} Reactions</a>
        <a class="nav-link active me-1 fs-5 d-none d-sm-block" aria-current="page"
          href="/reactions?college={{college}}">View {{college.capitalize()}} Reactions</a>
      </div>
    </div>
  </nav> -->

  <div class="food-dhall-title">
    <h1>{{college.capitalize()}} {{meal_time}}</h1>
  </div>
  {% if foods|length == 0: %}
  {% else: %}

  <!-- For large devices like laptops -->
  <div class="card-group mx-5 text-center justify-content-center mb-4">
    {% for food in foods: %}
    <div class="card mx-auto mx-sm-3 my-3 rounded" style="min-width: 16rem; max-width: 16rem;">
      {% if food[0] is none: %}
      <a href="/foodimg-submit?api_id={{food[5]}}&college={{college}}"><img src="" alt="Submit a Photo Here!"
          class="img-fluid rounded card-img-top" style="min-height: 11rem; max-height: 11rem;"></a>
      {% else: %}
      <a href="/food-desc?food_id={{food[4]}}&college={{college}}"><img src="{{food[0]}}" alt="No photo"
          class="img-fluid rounded card-img-top" style="min-height: 11rem; max-height: 11rem;"></a>
      {% endif %}
      <div class="card-body">
        <h5 class="card-title">
          <a href="/food-desc?food_id={{food[4]}}&college={{college}}" style="color: inherit;">{{food[1]}}</a>
        </h5>
        {% if food[2] == 0 %}
        <p class="card-text">Rating: No Rating Yet!</p>
        {% else: %}
        <p class="card-text">Rating: {{(food[3]/food[2])|round(1)}}</p>
        {% endif %}
        <!-- <a href="/food-desc?food_id={{food[4]}}&college={{college}}" style="padding-bottom: 10px;" class="card-text bttn">Submit a Review</a> -->
        <!-- <button type="button" class="bttn" id="myButton">Submit a review</button> -->
        <!-- <div id="foodModal" class="modal" role="dialog">
          <div class="modal-dialog">
            <div class="modal-content">
            </div>
          </div>
        </div> -->
      </div>
    </div>
    {% endfor %}
  </div>

  {% endif %}

  <div class="text-center">
    <button onclick="show()" id="show_hide" type="button" class="btn btn-primary">Show Reactions</button>
  </div>

  <br>
  <br>

  <div id="reactionsDiv" style="display: none;">
    {% if rows|length == 0: %}
    {% else: %}
    <div class="container-fluid">
      <div class="row" id="error-box">
        <div class="col-1 col-sm-3"></div>
        <div class="col-10 col-sm-6 pl-1 pr-1"
          style="border:2px solid #000000; border-radius: 0.4rem; min-height: 57vh; max-height:57vh; overflow: auto">
          {% for row in rows: %}
            {% if row[1] != "" %}
              <div class="row align-items-center">
                {% if row[2] == username %}
                  <div class="col-4 pt-2 pb-2" style="font-size: 16px;">
                    <!-- <p style="font-size: 16px;">{{row[3]}}</p> -->
                    <div class = "pBox mymessagetime" style = "padding-left: 10px"> {{row[4]}} </div>
                  </div>
                  <div class="col-8 pt-2 pb-2" style="font-size: 16px;">
                    <!-- <p style="font-size: 16px;">{{row[0]}}</p> -->
                      <div class="mymessage pBox" >
                        {{row[1]}}
                      </div>
                  </div>
                {% else: %}
                  <div class="col-8 pt-2 pb-2" style="font-size: 16px;">
                    <!-- <p style="font-size: 16px;">{{row[0]}}</p> -->
                      <div class="message pBox">
                        {{row[1]}}
                      </div>
                  </div>
                  <div class="col-4 pt-2 pb-2" style="font-size: 16px">
                    <!-- <p style="font-size: 16px;">{{row[3]}}</p> -->
                    <div class = "pBox messagetime" style = "padding-right: 10px"> {{row[4]}} </div>
                  </div>
                  
                {% endif %}
              </div>
            {% endif %}
            {% endfor %}
        </div>
        <div class="col-1 col-sm-3"></div>
      </div>
    </div>
    {% endif %}
    <br>
    <div class="container-fluid">
      <div class="row">
        <form action="reactions" method="POST" class="reactions-form" id="form1">
          <div class="controls">
            <div class="row">
              <div class="col-2 col-md-3"></div>
              <div class="col-8 col-md-6">
                <div class="form-group">
                  <textarea name="reaction" class="form-control" placeholder="Enter your reaction here!" rows="3"
                    cols="30" required></textarea>
                </div>
              </div>
              <div class="col-2 col-md-3"></div>
            </div>
            <br>
            <div class="row">
              <div class="col-sm">
                <input type="submit" class="btn btn-primary btn-send" value="React!" id="submit_but">
                <input type="hidden" name="college" value="{{college}}">
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <br>
  <br>
  
  <div class="text-center">
    <button onclick="show()" id="show_hide2" type="button" class="btn btn-primary">Show Reviews</button>
  </div>

  <br>
  <br>
  
  <div id="reviewsDiv" style="display:none"> 
    {% if reviews|length == 0: %}
      <div class="container-fluid">
        <div class="row">
          <div class="col-3"></div>
          <div class="col-6 pr-1 pl-1" style="border:2px solid #000000; border-radius: 0.4rem;">
            <p style="font-size: 16px; text-align:center; margin: 10px">No reviews submitted yet! Be the first to review!</p>
          </div>
          <div class="col-3"></div>
        </div>
      </div>
    {% else: %}
      <div class="container-fluid">
        <div class="row">
          <div class="col-2"></div>
          <div class="col-8 pl-1 pr-1 pt-1 pb-1" style="border:2px solid #000000; border-radius: 0.4rem; min-height: 15vh; max-height:30vh; overflow: auto">
            {% for review in reviews: %}
              {% if review[0] is not none: %}
                <div class="row border-bottom align-items-center">
                  <div class="col" style="font-size: 16px;">
                    <!-- <p style="font-size: 16px;">{{review[0]}}</p> -->
                    {{review[0]}}
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
          <div class="col-2"></div>
        </div>
      </div>
    {% endif %}
    <br>
    <hr>
    <div class="container-fluid">
      <div class="row">
          <form action="food-desc" method="POST" class="reviews-form" id="form2">
            <div class="controls">
              <div class="row">
                <div class="col-2 col-md-3"></div>
                <div class="col-8 col-md-6">
                  <p style="font-size: 16px; text-align:center;">Submit reviews and ratings here! Reviews can be left empty; ratings cannot.</p>

                  <div class="rating">
                      <input type="radio" id="star5" name="rate" value="5" required/>
                      <label for="star5" title="text">5 stars</label>
                      <input type="radio" id="star4" name="rate" value="4" required/>
                      <label for="star4" title="text">4 stars</label>
                      <input type="radio" id="star3" name="rate" value="3" required/>
                      <label for="star3" title="text">3 stars</label>
                      <input type="radio" id="star2" name="rate" value="2" required/>
                      <label for="star2" title="text">2 stars</label>
                      <input type="radio" id="star1" name="rate" value="1" required/>
                      <label for="star1" title="text">1 stars</label>
                      <!-- <input type="number" id="quantity" name="rating" min="1" max="5" value="3"> -->
                  </div>
                  <div class="form-group">
                      <textarea name="review" class="form-control mb-4" id="form2" placeholder="Leave a review here!" rows="3" cols = "30" ></textarea>
                  </div>
                </div>
                <div class="col-2 col-md-3"></div>
              </div>
              <br>
              <div class ="row">
                <div class="col-sm"></div>
                <div class="col-sm">
                  <p id="spnError" class="error" style="display: none; margin-top: -43px">Please select a rating!</p>
                </div>
                <div class="col-sm"></div>
              </div>
              <div class = "row">
                <div class="col-sm">
                  <input type="submit" id="btnSubmit" class="btn btn-primary btn-send" value="Submit!">
                  <input type="hidden" name="college" value="{{college}}">
                  <input type="hidden" name="food_id" value="{{food_id}}">
                </div>
              </div>
            </div>
          </form>
      </div>
    </div>
    <br>
    <br>
  </div>

  <div id="ex1" class="modal">
      <div id="reactionsDiv" style="display: none;">
      {% if rows|length == 0: %}
      {% else: %}
      <div class="container-fluid">
        <div class="row" id="error-box">
          <div class="col-1 col-sm-3"></div>
          <div class="col-10 col-sm-6 pl-1 pr-1"
            style="border:2px solid #000000; border-radius: 0.4rem; min-height: 57vh; max-height:57vh; overflow: auto">
            {% for row in rows: %}
              {% if row[1] != "" %}
                <div class="row align-items-center">
                  {% if row[2] == username %}
                    <div class="col-4 pt-2 pb-2" style="font-size: 16px;">
                      <!-- <p style="font-size: 16px;">{{row[3]}}</p> -->
                      <div class = "pBox mymessagetime" style = "padding-left: 10px"> {{row[4]}} </div>
                    </div>
                    <div class="col-8 pt-2 pb-2" style="font-size: 16px;">
                      <!-- <p style="font-size: 16px;">{{row[0]}}</p> -->
                        <div class="mymessage pBox" >
                          {{row[1]}}
                        </div>
                    </div>
                  {% else: %}
                    <div class="col-8 pt-2 pb-2" style="font-size: 16px;">
                      <!-- <p style="font-size: 16px;">{{row[0]}}</p> -->
                        <div class="message pBox">
                          {{row[1]}}
                        </div>
                    </div>
                    <div class="col-4 pt-2 pb-2" style="font-size: 16px">
                      <!-- <p style="font-size: 16px;">{{row[3]}}</p> -->
                      <div class = "pBox messagetime" style = "padding-right: 10px"> {{row[4]}} </div>
                    </div>

                  {% endif %}
                </div>
              {% endif %}
              {% endfor %}
          </div>
          <div class="col-1 col-sm-3"></div>
        </div>
      </div>
      {% endif %}
      <br>
      <div class="container-fluid">
        <div class="row">
          <form action="reactions" method="POST" class="reactions-form" id="form1">
            <div class="controls">
              <div class="row">
                <div class="col-2 col-md-3"></div>
                <div class="col-8 col-md-6">
                  <div class="form-group">
                    <textarea name="reaction" class="form-control" placeholder="Enter your reaction here!" rows="3"
                      cols="30" required></textarea>
                  </div>
                </div>
                <div class="col-2 col-md-3"></div>
              </div>
              <br>
              <div class="row">
                <div class="col-sm">
                  <input type="submit" class="btn btn-primary btn-send" value="React!" id="submit_but">
                  <input type="hidden" name="college" value="{{college}}">
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <a href="#" rel="modal:close">Close</a>
  </div>

  <!-- Link to open the modal -->
  <p><a href="#ex1" rel="modal:open">Open Modal</a></p>
  
  <script>
    function show() {
      var div = document.getElementById("reactionsDiv");
      var button = document.getElementById("show_hide");
      if (div.style.display === "none") {
        div.style.display = "block";
        button.textContent = "Hide Reactions";
      } else {
        div.style.display = "none";
        button.textContent = "Show Reactions";
      }
    }
  </script>
  
   <script>
    function show() {
      var div = document.getElementById("reviewsDiv");
      var button = document.getElementById("show_hide2");
      if (div.style.display === "none") {
        div.style.display = "block";
        button.textContent = "Hide Reviews";
      } else {
        div.style.display = "none";
        button.textContent = "Show Reviews";
      }
    }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>
  <script type=text/javascript>
    $(document).ready(function() {
      $('#form1').validate({
        errorClass: "error fail-alert",
        messages : {
          reaction: {
          required: "Please enter a reaction!",
          }
        }
      });
      // $SCRIPT_ROOT = {{ request.script_root | tojson | safe }};
      // longPoll();
    });
    
    $(submit_but).onclick(function (){
      longPoll();
    })

    function longPoll() {
        $.ajax({
          url: $SCRIPT_ROOT + "/reactions",
          success: function (data) {
            $('#message-box').html(data);
          },
          error: function (err) {
            $('#error-box').prepend('Error retrieving new messages..');
          },
          type: "GET",
          dataType: "json",
          complete: longPoll,
          timeout: 60000 // timeout every one minute
        });
      }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
    crossorigin="anonymous"></script>
</body>

</html>
