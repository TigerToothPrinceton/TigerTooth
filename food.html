<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"> -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" />


  <title>{{college.capitalize()}} {{meal_time}} Menu</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/food.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/reactions.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lato" />
</head>

<body>

  <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-primary">
    <div class="container-fluid">
       <a class="navbar-brand fs-4" href="index"><img src="https://i.imgur.com/AufcPrM.png" width="auto" height="50"> TigerTooth</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active fs-6 me-2" aria-current="page" href="/reactions?college={{college}}">View
              {{college.capitalize()}} Reactions</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active fs-6" aria-current="page" href="/history">Your Reviews</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- <nav class="navbar sticky-top navbar-light bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand fs-4" href="index">TigerTooth</a>
      <div class="navbar-nav">
        <a class="nav-link active me-1 fs-6 d-sm-none" aria-current="page" href="/reactions?college={{college}}">View
          {{college.capitalize()}} Reactions</a>
        <a class="nav-link active me-1 fs-5 d-none d-sm-block" aria-current="page"
          href="/reactions?college={{college}}">View {{college.capitalize()}} Reactions</a>
      </div>
    </div>
  </nav> -->

  <div class="food-dhall-title">
    <h1>{{college.capitalize()}} {{meal_time}}</h1>
  </div>
  {% if foods|length == 0: %}
  {% else: %}

  <!-- For large devices like laptops -->
  <div class="card-group mx-5 text-center justify-content-center mb-4">
    {% for food in foods: %}
    <div class="card mx-auto mx-sm-3 my-3 rounded" style="min-width: 16rem; max-width: 16rem;">
      {% if food[0] is none: %}
      <a href="/foodimg-submit?api_id={{food[5]}}&college={{college}}"><img src="" alt="Submit a Photo Here!"
          class="img-fluid rounded card-img-top" style="min-height: 11rem; max-height: 11rem;"></a>
      {% else: %}
      <a href="/food-desc?food_id={{food[4]}}&college={{college}}"><img src="{{food[0]}}" alt="No photo"
          class="img-fluid rounded card-img-top" style="min-height: 11rem; max-height: 11rem;"></a>
      {% endif %}
      <div class="card-body">
        <h5 class="card-title">
          <a href="/food-desc?food_id={{food[4]}}&college={{college}}" style="color: inherit;">{{food[1]}}</a>
        </h5>
        {% if food[2] == 0 %}
        <p class="card-text">Rating: No Rating Yet!</p>
        {% else: %}
        <p class="card-text">Rating: {{(food[3]/food[2])|round(1)}}</p>
        {% endif %}
        <a href="/food-desc?food_id={{food[4]}}&college={{college}}" class="btn bttn rounded" style="color: #fff">Submit a Review</a>
        <!-- <button type="button" class="bttn" id="myButton">Submit a review</button> -->
        <!-- <div id="foodModal" class="modal" role="dialog">
          <div class="modal-dialog">
            <div class="modal-content">
            </div>
          </div>
        </div> -->
      </div>
    </div>
    {% endfor %}
  </div>

  {% endif %}

  <div class="text-center">
    <button onclick="show()" id="show_hide" type="button" class="btn btn-primary">
      Show Reactions
    </button>
  </div>

  <br>
  <br>

  <div id="reactionsDiv" style="display: none;">
    {% if rows|length == 0: %}
    {% else: %}
    <div class="container-fluid">
      <div class="row">
        <div class="col-1 col-sm-3"></div>
        <div class="col-10 col-sm-6 pl-1 pr-1"
          style="border:2px solid #000000; border-radius: 0.4rem; min-height: 57vh; max-height:57vh; overflow: auto" id="message-box">
        </div>
        <div class="col-1 col-sm-3"></div>
      </div>
    </div>
    {% endif %}
    <br>
    <div class="container-fluid">
      <div class="row">
        <form action="reactions" method="POST" class="reactions-form" id="form1">
          <div class="controls">
            <div class="row">
              <div class="col-2 col-md-3"></div>
              <div class="col-8 col-md-6">
                <div class="form-group">
                  <textarea name="reaction" class="form-control" placeholder="Enter your reaction here!" rows="3"
                    cols="30" id="reactions-text" required></textarea>
                </div>
              </div>
              <div class="col-2 col-md-3"></div>
            </div>
            <br>
            <div class="row">
              <div class="col-sm">
                <input type="submit" class="btn btn-primary btn-send" value="React!" id="submit_but">
                <input type="hidden" id="collegeid" name="college" value="{{college}}">
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <br>
  <br>

  <script>
    function show() {
      var div = document.getElementById("reactionsDiv");
      var button = document.getElementById("show_hide");
      if (div.style.display === "none") {
        div.style.display = "block";
        button.textContent = "Hide Reactions";
      } else {
        div.style.display = "none";
        button.textContent = "Show Reactions";
      }
    }
  </script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>

  <script type=text/javascript>
    'use strict';

    $(document).ready(function() {
      $('#form1').validate({
        errorClass: "error fail-alert",
        messages : {
          reaction: {
          required: "Please enter a reaction!",
          }
        }
      });

      $("#form1").submit(function (event) 
      {
          let formData = {
            reaction: $("#reactions-text").val(),
            college: $("#collegeid").val(),
          };
          
          if (formData.reaction != '') {
            $.ajax({
              type: "POST",
              url: "/reactions",
              data: formData,
            }).done(function (data) {
              console.log(data);
              $('#reactions-text').val('');
            }).catch(function (err) {
              console.log(err);
            });

            event.preventDefault();
          }
      });

      // window.setInterval(function() {
      //       let college = $('#collegeid').val();
      //       college = encodeURIComponent(college);
      //       let url = '/reactions?college=' + college
            
      //       $.ajax(
      //          {
      //             type: 'GET',
      //             url: url,
      //             success: function(response) {
      //               $('#message-box').html(response);
      //             },
      //             error: function(err) {
      //               console.log(err);
      //             }
      //          }
      //       );
      // }, 1000);

      $('#show_hide').click(function() {
        console.log("React button clicked")
        longPoll();
      })
    });

    function longPoll() {
      console.log("In the longPoll function")
      let college = $('#collegeid').val();
      college = encodeURIComponent(college);
      let url = '/reactions?college=' + college

      $.ajax(
        {
          type: 'GET',
          url: url,
          success: function(response) {
            $('#message-box').html(response);
          },
          error: function(err) {
            console.log(err);
          },
          complete: longPoll
        }
      );
    }

        //  function handleResponse(response)
        //  { 
        //     $('#message-box').html(response);
        //  }

        //  function handleError(err)
        //  {
        //    console.log(err)
        //  }
          
        //  let request = null;
         
        //  function getReactions()
        //  {    
        //     let college = $('#collegeid').val();
        //     college = encodeURIComponent(college);
        //     let url = '/reactions?college=' + college
            
        //     if (request != null)
        //        request.abort();
            
        //     request = $.ajax(
        //        {
        //           type: 'GET',
        //           url: url,
        //           success: handleResponse
        //           error: handleError
        //        }
        //     );
        //  }

        //  function postReactions()
        //  {
        //    $("#form1").submit
        //    (
        //      function (event) 
        //      {
        //         let formData = {
        //           reaction: $("#reactions-text").val(),
        //           college: $("#collegeid").val(),
        //         };

        //         $.ajax({
        //           type: "POST",
        //           url: "/reactions",
        //           data: formData,
        //           dataType: "json",
        //           encode: true,
        //         }).done(function (data) {
        //           console.log(data);
        //         });

        //         event.preventDefault();
        //      }
        //    );
        //  }

        // //  function postReactions()
        // //  {
        // //   let formData = {
        // //     reaction: $("#reactions-text").val(),
        // //     college: $("#collegeid").val(),
        // //   };

        // //   $.ajax({
        // //     type: "POST",
        // //     url: "/reactions",
        // //     data: formData,
        // //     dataType: "json",
        // //     encode: true,
        // //   }).done(function (data) {
        // //     console.log(data);
        // //   }).catch(function (err) {
        // //     console.log(err)
        // //   });

        // //   event.preventDefault();
        // //  }
         
        //  function setup()
        //  {
        //     $('#form1').validate({
        //       errorClass: "error fail-alert",
        //       messages : {
        //         reaction: {
        //         required: "Please enter a reaction!",
        //         }
        //       }
        //     });
        //     $("#form1").submit(
        //       function (event) 
        //       {
        //           let formData = {
        //             reaction: $("#reactions-text").val(),
        //             college: $("#collegeid").val(),
        //           };

        //           $.ajax({
        //             type: "POST",
        //             url: "/reactions",
        //             data: formData,
        //             dataType: "json",
        //             encode: true,
        //           }).done(function (data) {
        //             console.log(data);
        //           });

        //           event.preventDefault();
        //       });
        //     // $('#form1').on('submit', postReactions);
        //     window.setInterval(getReactions, 1000);
        //     // $('#authorInput').focus();
        //     // $('#authorInput').on('input', getResults);
        //  }
         
        //  $(document).ready(setup()); 
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
    crossorigin="anonymous"></script>
</body>

</html>
